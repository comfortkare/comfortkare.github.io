<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Testimonial – Comfort Kare</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .rating-container {
      text-align: center;
      margin: 30px auto;
    }

    .stars {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
    }

    .stars input[type="radio"] {
      display: none;
    }

    .stars label {
      font-size: 2.2rem;
      color: gray;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .stars input[type="radio"]:checked ~ label {
      color: gold;
    }

    .stars label:hover,
    .stars label:hover ~ label {
      color: orange;
      transform: scale(1.2);
    }

    .rating-text {
      font-size: 1.2rem;
      margin-top: 10px;
    }

    #thanks {
      text-align: center;
      font-weight: bold;
      color: green;
      display: none;
    }

    #chart-container {
      max-width: 500px;
      margin: 40px auto;
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="header-container">
      <a href="index.html"><img src="logo.png" class="logo" alt="Comfort Kare Logo"></a>
      <nav class="main-nav">
        <a href="index.html">Home</a>
        <div class="dropdown">
          <button class="dropbtn">Profile</button>
          <div class="dropdown-content">
            <a href="about.html">About Us</a>
            <a href="testimonial.html">Testimonial</a>
            <a href="brochure.html">Download Brochures</a>
          </div>
        </div>
        <a href="product.html">Our Product Range</a>
        <a href="contact.html">Contact Us</a>
        <a href="tel:+917868879893">Call</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="rating-container">
      <h2>Rate Our Product Quality</h2>
      <form id="ratingForm">
        <div class="stars">
          <input type="radio" id="star1" name="stars" value="1"><label for="star1">1⭐</label>
          <input type="radio" id="star2" name="stars" value="2"><label for="star2">2⭐</label>
          <input type="radio" id="star3" name="stars" value="3"><label for="star3">3⭐</label>
          <input type="radio" id="star4" name="stars" value="4"><label for="star4">4⭐</label>
          <input type="radio" id="star5" name="stars" value="5"><label for="star5">5⭐</label>
        </div>
        <button type="submit">Submit</button>
      </form>
      <p id="thanks">Thanks for your rating!</p>
    </section>

    <div id="chart-container">
      <canvas id="ratingChart"></canvas>
    </div>
  </main>

  <footer>
    <p style="text-align:right">© 2025 Comfort Kare. All rights reserved.</p>
  </footer>

  <script>
    const form = document.getElementById("ratingForm");
    const thanks = document.getElementById("thanks");
    const chartCanvas = document.getElementById("ratingChart");
    const chartData = {
      labels: ['1 Star', '2 Star', '3 Star', '4 Star', '5 Star'],
      datasets: [{
        label: 'Ratings %',
        backgroundColor: ['#ff9999','#ffcc99','#ffff99','#ccff99','#99ff99'],
        data: [0, 0, 0, 0, 0]
      }]
    };
    let ratingChart;

    function updateChart(data) {
      const total = data.reduce((a, b) => a + b, 0);
      const percentages = data.map(v => total ? Math.round((v / total) * 100) : 0);
      chartData.datasets[0].data = percentages;
      if (ratingChart) {
        ratingChart.update();
      } else {
        ratingChart = new Chart(chartCanvas, {
          type: 'bar',
          data: chartData,
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
                title: {
                  display: true,
                  text: 'Percentage (%)'
                }
              }
            }
          }
        });
      }
    }

    function getRatings() {
      const saved = localStorage.getItem("ratingsData");
      return saved ? JSON.parse(saved) : [0, 0, 0, 0, 0];
    }

    function saveRatings(data) {
      localStorage.setItem("ratingsData", JSON.stringify(data));
    }

    form.addEventListener("submit", function(e) {
      e.preventDefault();
      if (localStorage.getItem("alreadyRated")) {
        alert("You have already rated.");
        return;
      }
      const rating = +document.querySelector('input[name="stars"]:checked')?.value;
      if (!rating) return alert("Please select a rating.");

      const data = getRatings();
      data[rating - 1]++;
      saveRatings(data);
      localStorage.setItem("alreadyRated", "true");

      updateChart(data);
      thanks.style.display = "block";
      form.style.display = "none";
    });

    // Initial load
    updateChart(getRatings());
    if (localStorage.getItem("alreadyRated")) {
      form.style.display = "none";
      thanks.style.display = "block";
    }
  </script>
</body>
</html>
